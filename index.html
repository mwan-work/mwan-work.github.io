<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Game Card OCR (Title + Skills)</title>
  <script src="https://unpkg.com/tesseract.js@5/dist/tesseract.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { margin-bottom: 10px; }
    textarea { width: 100%; height: 110px; margin-top: 6px; }
    .section { margin-top: 18px; }
  </style>
</head>
<body>
  <h2>Upload Image → Extract Title & Skills → English</h2>

  <input type="file" id="imageInput" accept="image/*" />
  <br />
  <button onclick="processImage()">Process</button>

  <div class="section">
    <h3>Card Title (English)</h3>
    <textarea id="titleText"></textarea>
  </div>

  <div class="section">
    <h3>Main Skill (English)</h3>
    <textarea id="mainSkillText"></textarea>
  </div>

  <div class="section">
    <h3>Sub Skill (English)</h3>
    <textarea id="subSkillText"></textarea>
  </div>

  <div class="section">
    <h3>Awakening Skill (English)</h3>
    <textarea id="awakeningSkillText"></textarea>
  </div>

  <script>
    async function processImage() {
      const file = document.getElementById('imageInput').files[0];
      if (!file) return alert('Upload an image first');

      document.getElementById('titleText').value = 'Processing...';
      document.getElementById('mainSkillText').value = '';
      document.getElementById('subSkillText').value = '';
      document.getElementById('awakeningSkillText').value = '';

      const result = await Tesseract.recognize(file, 'jpn');
      const raw = result.data.text;

      const lines = raw.split('\n').map(l => l.trim()).filter(Boolean);
      const joined = lines.join(' ');

      const title = lines[0] || '';

      const mainSkillMatch = joined.match(/スキル[\s\S]*?子分スキル/);
      const subSkillMatch = joined.match(/子分スキル[\s\S]*?覚醒スキル/);
      const awakeningSkillMatch = joined.match(/覚醒スキル[\s\S]*/);

      const mainSkill = mainSkillMatch ? mainSkillMatch[0].replace('スキル', '') : '';
      const subSkill = subSkillMatch ? subSkillMatch[0].replace('子分スキル', '') : '';
      const awakeningSkill = awakeningSkillMatch ? awakeningSkillMatch[0].replace('覚醒スキル', '') : '';

      document.getElementById('titleText').value = await translate(title);
      document.getElementById('mainSkillText').value = await translate(mainSkill);
      document.getElementById('subSkillText').value = await translate(subSkill);
      document.getElementById('awakeningSkillText').value = await translate(awakeningSkill);
    }

    async function translate(text) {
      if (!text) return '';

      const response = await fetch('https://libretranslate.de/translate', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          q: text,
          source: 'ja',
          target: 'en',
          format: 'text'
        })
      });

      const data = await response.json();
      return data.translatedText || '';
    }
  </script>
</body>
</html>
